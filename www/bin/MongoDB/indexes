#!/bin/bash

M_ROOT="$PWD/../.."
parent="$1"
node="$2"
IFS='
'
chunksmax=0
datasizemax=0
indexsizemax=0

print_table_2() {
  echo "<div class=\"tr\"><div class=\"td1\">${1}</div><div class=\"td2\">${2}</div></div>"
}

echo "<div style=\"display: table; width: 720px; margin-left: 60px;\">"
[ -f "$M_ROOT/standalone/MongoDB/data/${parent}.${node}.dat" ] || exit 0

collinfo=`cat "$M_ROOT/standalone/MongoDB/data/${parent}.${node}.dat"`

for index in `echo "$collinfo" | grep '^index_sizes=' | cut -d'=' -f2 | "$M_ROOT"/lib/json2txt` ; do
  index_name=`echo "$index" | cut -d'/' -f2 | cut -d'|' -f1`
  index_size=`echo "$index" | cut -d'|' -f2`
  index_size=`expr $index_size / 1024`
  
  csunits="KB"
  if [ ${#index_size} -gt 3 ] ; then
    index_size=`expr $index_size / 1024` && csunits="MB"
  elif [ ${#index_size} -gt 6 ] ; then
    index_size=`expr $index_size / 1048576` && csunits="GB"
  fi
  index_size="$index_size $csunits"
  print_table_2 $index_name $index_size
done


echo "</div>"

